"use strict";(self.webpackChunkavalonia_docs=self.webpackChunkavalonia_docs||[]).push([[7919],{24958:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"troubleshooting","title":"Troubleshooting","description":"Trouble Restoring NuGet Packages","source":"@site/xpf/troubleshooting.md","sourceDirName":".","slug":"/troubleshooting","permalink":"/zh-Hans/xpf/troubleshooting","draft":false,"unlisted":false,"editUrl":"https://github.com/AvaloniaUI/avalonia-docs/tree/main/xpf/troubleshooting.md","tags":[],"version":"current","frontMatter":{"id":"troubleshooting","title":"Troubleshooting"},"sidebar":"documentationSidebar","previous":{"title":"Window Handles","permalink":"/zh-Hans/xpf/advanced/window-handles"},"next":{"title":"Release Notes","permalink":"/zh-Hans/xpf/release-notes"}}');var s=i(74848),t=i(28453);const l={id:"troubleshooting",title:"Troubleshooting"},r=void 0,a={},c=[{value:"Trouble Restoring NuGet Packages",id:"trouble-restoring-nuget-packages",level:2},{value:"Check Your Firewall Settings",id:"check-your-firewall-settings",level:3},{value:"Check You Have Set Up NuGet.config",id:"check-you-have-set-up-nugetconfig",level:3},{value:"Clear Your NuGet HTTP Cache",id:"clear-your-nuget-http-cache",level:3},{value:"Listening for XPF logs",id:"listening-for-xpf-logs",level:2},{value:"Listening for Avalonia logs",id:"listening-for-avalonia-logs",level:2},{value:".LogToTrace in a custom Avalonia initialization",id:"logtotrace-in-a-custom-avalonia-initialization",level:3},{value:"Override Logger.Sink",id:"override-loggersink",level:3},{value:"System.Resources.Extensions",id:"systemresourcesextensions",level:2},{value:"NullReferenceException or MissingMethodException",id:"nullreferenceexception-or-missingmethodexception",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"trouble-restoring-nuget-packages",children:"Trouble Restoring NuGet Packages"}),"\n",(0,s.jsxs)(n.p,{children:["If you are unable to restore XPF and/or Avalonia packages (e.g. ",(0,s.jsx)(n.code,{children:"Xpf.Sdk"})," or an Avalonia ",(0,s.jsx)(n.code,{children:"cibuild"})," package is reported as missing) then follow the steps below:"]}),"\n",(0,s.jsx)(n.h3,{id:"check-your-firewall-settings",children:"Check Your Firewall Settings"}),"\n",(0,s.jsx)(n.p,{children:"Try opening the following URLs in your browser:"}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["Use the username ",(0,s.jsx)(n.code,{children:"license"})," and your license key as the password when asked."]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://xpf-nuget-feed.avaloniaui.net/",children:"https://xpf-nuget-feed.avaloniaui.net/"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://xpf-nuget-feed.avaloniaui.net/v3/index.json",children:"https://xpf-nuget-feed.avaloniaui.net/v3/index.json"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://nuget-feed-all.avaloniaui.net/v3/index.json",children:"https://nuget-feed-all.avaloniaui.net/v3/index.json"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The first URL should display a page similar to the package listing on ",(0,s.jsx)(n.a,{href:"https://www.nuget.org/packages",children:"nuget.org"}),"; the second two URLs should display some JSON."]}),"\n",(0,s.jsx)(n.p,{children:"If you are unable to view any of these URls, check your firewall settings."}),"\n",(0,s.jsx)(n.p,{children:"If you are unable to login with your license key, it may have expired. Ask support for a new one."}),"\n",(0,s.jsx)(n.h3,{id:"check-you-have-set-up-nugetconfig",children:"Check You Have Set Up NuGet.config"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Ensure that you have added a ",(0,s.jsx)(n.a,{href:"./getting-started#step-2-add-a-nugetconfig",children:"NuGet.config"})," file, ",(0,s.jsx)(n.strong,{children:"and that it is in the same directory"})," as the ",(0,s.jsx)(n.code,{children:".sln"})," file you are loading"]}),"\n",(0,s.jsxs)(n.li,{children:["Ensure that you have added a valid license key to your ",(0,s.jsx)(n.code,{children:"NuGet.config"})," file"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"clear-your-nuget-http-cache",children:"Clear Your NuGet HTTP Cache"}),"\n",(0,s.jsx)(n.p,{children:"Run the following commands from the command-line:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"dotnet nuget locals http-cache --clear\ndotnet restore\n"})}),"\n",(0,s.jsx)(n.h2,{id:"listening-for-xpf-logs",children:"Listening for XPF logs"}),"\n",(0,s.jsx)(n.p,{children:"XPF logs are controlled via environment variables."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ATLANTIS_LOG_OUTPUTS"}),": ",(0,s.jsx)(n.code,{children:"console"}),", ",(0,s.jsx)(n.code,{children:"trace"}),", ",(0,s.jsx)(n.code,{children:"file=filePath"}),". Multiple values are supported separated by ",(0,s.jsx)(n.code,{children:";"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ATLANTIS_LOG_LEVEL"}),": ",(0,s.jsx)(n.code,{children:"Verbose"}),", ",(0,s.jsx)(n.code,{children:"Information"}),", ",(0,s.jsx)(n.code,{children:"Debug"}),", ",(0,s.jsx)(n.code,{children:"Warning"}),", ",(0,s.jsx)(n.code,{children:"Error"}),", ",(0,s.jsx)(n.code,{children:"Fatal"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"listening-for-avalonia-logs",children:"Listening for Avalonia logs"}),"\n",(0,s.jsx)(n.p,{children:"In some situations it might be useful to gather Avalonia logs, as XPF works on top of it. And it can be really helpful investigating issues."}),"\n",(0,s.jsx)(n.p,{children:"Typically, there are two possible ways to listen for Avalonia logs"}),"\n",(0,s.jsx)(n.h3,{id:"logtotrace-in-a-custom-avalonia-initialization",children:".LogToTrace in a custom Avalonia initialization"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Follow ",(0,s.jsx)(n.a,{href:"./customizing-init",children:"instructions"})," on how to setup custom Avalonia initialization."]}),"\n",(0,s.jsxs)(n.li,{children:["Then you will be able to call ",(0,s.jsx)(n.code,{children:".LogToTrace()"})," with optional severity parameter in the AppBuilder chain, like this:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-diff",children:"        AppBuilder.Configure<AvaloniaUI.Xpf.Helpers.DefaultXpfAvaloniaApplication>()\n            .UsePlatformDetect()\n+           .LogToTrace(LogEventLevel.Warning)\n            .WithAvaloniaXpf()\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This will redirect all Avalonia logs to the .NET Trace listener. Which can be redirected as well - ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/dotnet/framework/debug-trace-profile/trace-listeners",children:"Trace Listeners"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"override-loggersink",children:"Override Logger.Sink"}),"\n",(0,s.jsxs)(n.p,{children:["Static property ",(0,s.jsx)(n.code,{children:"Logger.Sink"})," has a public setter and can be overridden by custom implementation."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public void Initialize()\n{\n    // You can override Logger.Sink value at any point of application lifetime,\n    // But preferably to do it as early as possible, or even in the custom Avalonia initialization.\n    Logger.Sink = new MyLogger();\n}\n\npublic class MyLogger : ILogSink\n{\n    // Implement all members\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"systemresourcesextensions",children:"System.Resources.Extensions"}),"\n",(0,s.jsx)(n.p,{children:"If you encounter the following exception:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"System.IO.FileNotFoundException: Could not load file or assembly 'System.Resources.Extensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51'. The system cannot find the file specified.\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Then install the ",(0,s.jsx)(n.code,{children:"System.Resources.Extensions"})," package via nuget:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<PackageReference Include="System.Resources.Extensions" Version="7.0.0" />\n'})}),"\n",(0,s.jsx)(n.p,{children:"The 7.0.0 version should also be compatible with .NET 6."}),"\n",(0,s.jsx)(n.h2,{id:"nullreferenceexception-or-missingmethodexception",children:"NullReferenceException or MissingMethodException"}),"\n",(0,s.jsxs)(n.p,{children:["If you experience a ",(0,s.jsx)(n.code,{children:"NullReferenceException"})," or ",(0,s.jsx)(n.code,{children:"MissingMethodException"})," after upgrading XPF, try cleaning your project or deleting your ",(0,s.jsx)(n.code,{children:"bin"}),"/",(0,s.jsx)(n.code,{children:"obj"})," directories."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>r});var o=i(96540);const s={},t=o.createContext(s);function l(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);