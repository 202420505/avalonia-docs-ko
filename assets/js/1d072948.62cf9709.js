"use strict";(self.webpackChunkavalonia_docs=self.webpackChunkavalonia_docs||[]).push([[3808],{85861:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>h});const l=JSON.parse('{"id":"tutorials/music-store-app/searching-for-albums","title":"Album Service","description":"TUTORIALS - Music Store App","source":"@site/docs/tutorials/music-store-app/searching-for-albums.md","sourceDirName":"tutorials/music-store-app","slug":"/tutorials/music-store-app/searching-for-albums","permalink":"/avalonia-docs-ko/docs/tutorials/music-store-app/searching-for-albums","draft":false,"unlisted":false,"editUrl":"https://github.com/202420505/avalonia-docs-ko/tree/main/docs/tutorials/music-store-app/searching-for-albums.md","tags":[],"version":"current","lastUpdatedBy":"Q","lastUpdatedAt":1755590087000,"frontMatter":{"description":"TUTORIALS - Music Store App"},"sidebar":"documentationSidebar","previous":{"title":"Album View","permalink":"/avalonia-docs-ko/docs/tutorials/music-store-app/album-view"},"next":{"title":"Displaying Images","permalink":"/avalonia-docs-ko/docs/tutorials/music-store-app/displaying-images"}}');var i=s(74848),t=s(28453);const a=s.p+"assets/images/image-20210310013703557-4b3a740b00d571905d1a77964fa72a62.png",r=s.p+"assets/images/image-20210310110401944-65cd68e142357ed5ab9932b89a96d791.png",o={description:"TUTORIALS - Music Store App"},c="Album Service",d={},h=[{value:"Apple Web API Package",id:"apple-web-api-package",level:2},{value:"MVVM Model",id:"mvvm-model",level:2},{value:"Album View Model",id:"album-view-model",level:2},{value:"Start the Search",id:"start-the-search",level:2},{value:"Bind the Album View",id:"bind-the-album-view",level:2}];function u(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"album-service",children:"Album Service"})}),"\n",(0,i.jsx)(n.p,{children:"On this page, you will add some business logic to the app This will allow you to replace the mock data and get some real album data from the search. This business logic code forms the 'Model' part of the MVVM pattern."}),"\n",(0,i.jsxs)(n.p,{children:["To implement a real album search in the app, you will use a ",(0,i.jsx)(n.em,{children:"NuGet"})," package that can call the ",(0,i.jsx)(n.em,{children:"Apple iTunes"})," Web API album search.\nFirstly, let's remove the constructor for mock search that we will not need anymore."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Go to ",(0,i.jsx)(n.strong,{children:"MusicStoreViewModel.cs"})," file."]}),"\n",(0,i.jsx)(n.li,{children:"Remove constructor."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"public MusicStoreViewModel()\n{\n    SearchResults.Add(new AlbumViewModel());\n    SearchResults.Add(new AlbumViewModel());\n    SearchResults.Add(new AlbumViewModel());\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"This constructor was only used for testing the UI with mock data and is no longer needed."}),"\n",(0,i.jsx)(n.h2,{id:"apple-web-api-package",children:"Apple Web API Package"}),"\n",(0,i.jsxs)(n.p,{children:["Follow this procedure to add the required ",(0,i.jsx)(n.em,{children:"NuGet"})," package:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Stop the app if it is still running."}),"\n",(0,i.jsx)(n.li,{children:"Right-click the project."}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Manage NuGet Packages"}),"."]}),"\n"]}),"\n",(0,i.jsx)("p",{children:(0,i.jsx)("img",{className:"image-medium-zoom",src:a,alt:""})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Type 'itunes' in the search box (top-left)."}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"iTunesSearch"}),", then click ",(0,i.jsx)(n.strong,{children:"Install"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"mvvm-model",children:"MVVM Model"}),"\n",(0,i.jsx)(n.p,{children:"In this tutorial the application is simple, and you can implement the business services required for the 'Model' part of the MVVM pattern, in one class. This class will contain both the data model for an album, and the method needed for the search."}),"\n",(0,i.jsx)(n.p,{children:"Follow this procedure to add the album business logic:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["In the solution explorer, right-click the ",(0,i.jsx)(n.strong,{children:"/Models"})," folder and then click ",(0,i.jsx)(n.strong,{children:"Add"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Class"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"When prompted for the name, type 'Album'."}),"\n",(0,i.jsx)(n.li,{children:"Add the following code:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using iTunesSearch.Library;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Threading.Tasks;\n\nnamespace Avalonia.MusicStore.Models\n{\n    public class Album\n    {\n        private static iTunesSearchManager s_SearchManager = new();\n\n        public string Artist { get; set; }\n        public string Title { get; set; }\n        public string CoverUrl { get; set; }\n\n        public Album(string artist, string title, string coverUrl)\n        {\n            Artist = artist;\n            Title = title;\n            CoverUrl = coverUrl;\n        }\n\n        public static async Task<IEnumerable<Album>> SearchAsync(string? searchTerm)\n        {\n            if (string.IsNullOrWhiteSpace(searchTerm))\n            {\n                return Enumerable.Empty<Album>();\n            }\n            \n            var query = await s_SearchManager.GetAlbumsAsync(searchTerm)\n                .ConfigureAwait(false);\n                \n            return query.Albums.Select(x =>\n                new Album(x.ArtistName, x.CollectionName, \n                    x.ArtworkUrl100.Replace("100x100bb", "600x600bb")));\n        }\n    }  \n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"album-view-model",children:"Album View Model"}),"\n",(0,i.jsx)(n.p,{children:"In order to display the data from the Web API for each album (data model) in the search results list, you will create an album view model, and this will be bound to the album view (tile) for display."}),"\n",(0,i.jsx)(n.p,{children:"Your album view model is currently empty. It will need to be able to store the album data from the search, and have some properties for the artist name and album title. These will then be bound to the view for display."}),"\n",(0,i.jsx)(n.p,{children:"In this step you will use a common pattern for the dependent relationship between a view model and a (business logic) model. This is where the view model contains an instance of the data model, and then exposes certain of its properties, as required for display."}),"\n",(0,i.jsx)(n.p,{children:"Follow this procedure to prepare the album view model:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Locate and open the ",(0,i.jsx)(n.strong,{children:"AlbumViewModel.cs"})," file."]}),"\n",(0,i.jsx)(n.li,{children:"Add the code as shown:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"private readonly Album _album;\n\npublic AlbumViewModel(Album album)\n{\n    _album = album;\n}\n\npublic string Artist => _album.Artist;\n\npublic string Title => _album.Title;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Note that as the view model properties will not change in the UI during runtime, they have no setter and a plain getter."}),"\n",(0,i.jsx)(n.h2,{id:"start-the-search",children:"Start the Search"}),"\n",(0,i.jsxs)(n.p,{children:["In this step, you\u2019ll add the ability to search for albums in real-time as the user types in the music store dialog. When it finishes, the search places its results in the observable collection ",(0,i.jsx)(n.code,{children:"SearchResults"}),". This collection is already bound to the list box, so with a small adjustment to the album view, the results of the search will display as the tiles you prepared earlier."]}),"\n",(0,i.jsx)(n.p,{children:"Follow this procedure to trigger the search with a short delay when the search text changes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Locate and open the ",(0,i.jsx)(n.strong,{children:"MusicStoreView.axaml"})," file."]}),"\n",(0,i.jsx)(n.li,{children:"Find the line with SearchText binding and add a Delay property as shown below:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<TextBox Watermark="Search for Albums...." Text="{Binding SearchText, Delay=400}" />\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Delay=400"})," ensures that input is only propagated to the view model after the user pauses for 400ms, preventing unnecessary search calls."]}),"\n",(0,i.jsx)(n.p,{children:"Now:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Locate and open the ",(0,i.jsx)(n.strong,{children:"MusicStoreViewModel.cs"})," file."]}),"\n",(0,i.jsx)(n.li,{children:"Add the following method there:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"partial void OnSearchTextChanged(string? value)\n{\n    _ = DoSearch(SearchText);\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"This method is automatically called whenever the SearchText property changes."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Add ",(0,i.jsx)(n.code,{children:"DoSearch"})," implementation:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"private async Task DoSearch(string? term)\n{\n    IsBusy = true;\n    SearchResults.Clear();\n\n    var albums = await Album.SearchAsync(term);\n\n    foreach (var album in albums)\n    {\n        var vm = new AlbumViewModel(album);\n        SearchResults.Add(vm);\n    }\n\n    IsBusy = false;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"This method:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Sets a busy flag to show the loading spinner in the UI."}),"\n",(0,i.jsx)(n.li,{children:"Clears existing results."}),"\n",(0,i.jsxs)(n.li,{children:["Calls the album model's ",(0,i.jsx)(n.code,{children:"SearchAsync"})," method to fetch data from the iTunes API."]}),"\n",(0,i.jsxs)(n.li,{children:["Wraps each result in an ",(0,i.jsx)(n.code,{children:"AlbumViewModel"})," and adds it to ",(0,i.jsx)(n.code,{children:"SearchResults"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Now your ",(0,i.jsx)(n.strong,{children:"MusicStoreViewModel"})," file should now look like this:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"using System;\nusing System.Collections.ObjectModel;\nusing System.Linq;\nusing System.Threading;\nusing System.Threading.Tasks;\nusing Avalonia.MusicStore.Messages;\nusing Avalonia.MusicStore.Models;\nusing CommunityToolkit.Mvvm.ComponentModel;\nusing CommunityToolkit.Mvvm.Input;\nusing CommunityToolkit.Mvvm.Messaging;\n\nnamespace Avalonia.MusicStore.ViewModels\n{\n    public partial class MusicStoreViewModel : ViewModelBase\n    {\n        [ObservableProperty]\n        public partial string? SearchText { get; set; }\n\n        [ObservableProperty]\n        public partial bool IsBusy { get; private set; }\n\n        [ObservableProperty]\n        public partial AlbumViewModel? SelectedAlbum { get; set; }\n\n        public ObservableCollection<AlbumViewModel> SearchResults { get; } = new();\n\n        private async Task DoSearch(string? term)\n        {\n            IsBusy = true;\n            SearchResults.Clear();\n\n            var albums = await Album.SearchAsync(term);\n\n            foreach (var album in albums)\n            {\n                var vm = new AlbumViewModel(album);\n                SearchResults.Add(vm);\n            }\n\n            IsBusy = false;\n        }\n\n        partial void OnSearchTextChanged(string value)\n        {\n            _ = DoSearch(SearchText);\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"bind-the-album-view",children:"Bind the Album View"}),"\n",(0,i.jsx)(n.p,{children:"Your work on the previous page to format the album 'tile' view did not add any way to display the text results of the search."}),"\n",(0,i.jsx)(n.p,{children:"Follow this procedure to add the album name and artist name to the tile:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Locate and open the ",(0,i.jsx)(n.strong,{children:"AlbumView.axaml"})," file."]}),"\n",(0,i.jsx)(n.li,{children:"Add the two text block controls with their data bindings, as shown:"}),"\n",(0,i.jsxs)(n.li,{children:["To have compiled binding working, you need to indicate the datatype used in the view : ",(0,i.jsx)(n.code,{children:"AlbumViewModel"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<UserControl ...\n  xmlns:vm="using:Avalonia.MusicStore.ViewModels"\n  x:DataType="vm:AlbumViewModel" >\n\n  <StackPanel Spacing="5" Width="200">\n    <Border CornerRadius="10" ClipToBounds="True">\n      <Panel Background="#7FFF22DD">\n        <Image Width="200" Stretch="Uniform" />\n        <Panel Height="200">\n          <PathIcon Height="75" Width="75" Data="{StaticResource music_regular}" />\n        </Panel>\n      </Panel>\n    </Border>\n    <TextBlock HorizontalAlignment="Center" Text="{Binding Title}"/>\n    <TextBlock HorizontalAlignment="Center" Text="{Binding Artist}"/>\n  </StackPanel>\n</UserControl>\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Debug"})," to compile and run the project."]}),"\n",(0,i.jsx)(n.li,{children:"Click the icon button."}),"\n",(0,i.jsx)(n.li,{children:"Type some search text."}),"\n"]}),"\n",(0,i.jsx)("p",{children:(0,i.jsx)("img",{className:"image-medium-zoom",src:r,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"On the next page, you will learn how to improve the look of the app by retrieving the cover art for each album. This will be displayed on the tile instead of the note icon."})]})}function m(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>r});var l=s(96540);const i={},t=l.createContext(i);function a(e){const n=l.useContext(t);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);